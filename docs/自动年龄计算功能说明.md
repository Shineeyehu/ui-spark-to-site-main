# 自动年龄计算功能说明

## 🎯 功能概述

在生日页面选择出生年月日后，系统会自动计算并填入相应的年龄，提升用户体验。

## ✨ 功能特性

### 1. 自动年龄计算
- **触发条件**：用户选择或修改出生日期时
- **计算逻辑**：基于当前日期和出生日期计算准确年龄
- **生日处理**：考虑是否已过生日，确保年龄准确性

### 2. 智能年龄字段
- **自动填充**：出生日期改变时自动更新年龄
- **只读状态**：有出生日期时年龄字段变为只读
- **视觉提示**：显示"自动计算"标签和提示信息

### 3. 用户体验优化
- **即时反馈**：选择日期后立即显示计算出的年龄
- **防误操作**：年龄字段在有出生日期时不可手动编辑
- **友好提示**：显示"年龄已根据出生日期自动计算"提示

## 🔧 技术实现

### 核心函数

```typescript
// 计算年龄的函数
const calculateAge = (birthDate: string): string => {
  if (!birthDate) return '';
  
  const today = new Date();
  const birth = new Date(birthDate);
  
  // 检查日期是否有效
  if (isNaN(birth.getTime())) return '';
  
  let age = today.getFullYear() - birth.getFullYear();
  const monthDiff = today.getMonth() - birth.getMonth();
  
  // 如果还没到生日，年龄减1
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--;
  }
  
  // 确保年龄不为负数
  return Math.max(0, age).toString();
};
```

### 自动更新逻辑

```typescript
const updateFormData = (field: keyof FormData, value: string) => {
  setFormData(prev => {
    const newData = { ...prev, [field]: value };
    
    // 如果出生日期改变，自动计算年龄
    if (field === 'birthDate' && value) {
      const calculatedAge = calculateAge(value);
      newData.age = calculatedAge;
    }
    
    return newData;
  });
  
  // Clear error when user starts typing
  if (errors[field]) {
    setErrors(prev => ({ ...prev, [field]: '' }));
  }
};
```

### UI优化

```tsx
{/* Age - Sixth Row */}
<div className="space-y-1">
  <Label className="text-gray-600 font-normal text-sm flex items-center gap-1">
    年龄
    <span className="text-xs text-gray-400">(自动计算)</span>
  </Label>
  <Input
    type="number"
    value={formData.age}
    onChange={(e) => updateFormData('age', e.target.value)}
    placeholder="20"
    min="1"
    max="120"
    readOnly={!!formData.birthDate} // 如果有出生日期，年龄字段只读
    className={`w-full bg-gray-50 border-gray-200 rounded-lg h-10 text-gray-700 font-normal text-center ${
      errors.age ? 'border-red-400' : ''
    } ${!!formData.birthDate ? 'bg-gray-100 cursor-not-allowed' : ''}`}
  />
  {formData.birthDate && (
    <p className="text-xs text-gray-500 mt-1">
      💡 年龄已根据出生日期自动计算
    </p>
  )}
  {errors.age && <p className="text-red-500 text-xs mt-1">{errors.age}</p>}
</div>
```

## 📱 用户体验流程

### 1. 初始状态
- 年龄字段显示默认值（20岁）
- 字段可编辑，显示占位符

### 2. 选择出生日期
- 用户选择出生年月日
- 系统立即计算年龄
- 年龄字段自动更新
- 显示"年龄已根据出生日期自动计算"提示

### 3. 年龄字段状态变化
- 字段变为只读状态
- 背景色变为灰色
- 鼠标悬停显示"不可编辑"状态
- 显示自动计算提示

## 🎨 视觉设计

### 标签设计
- 主标签：`年龄`
- 副标签：`(自动计算)` - 灰色小字
- 提示信息：`💡 年龄已根据出生日期自动计算`

### 输入框状态
- **可编辑状态**：白色背景，正常边框
- **只读状态**：灰色背景，不可编辑光标
- **错误状态**：红色边框

## 🔍 测试场景

### 1. 正常流程测试
- 选择不同出生日期，验证年龄计算准确性
- 检查年龄字段是否变为只读
- 验证提示信息是否正确显示

### 2. 边界情况测试
- 选择今天日期（年龄应为0）
- 选择未来日期（年龄应为0）
- 选择很久以前的日期（验证大年龄计算）

### 3. 生日边界测试
- 选择昨天生日（年龄+1）
- 选择明天生日（年龄不变）
- 选择今天生日（年龄不变）

## 📊 功能优势

### 1. 用户体验
- **减少输入**：用户无需手动计算年龄
- **避免错误**：防止年龄计算错误
- **即时反馈**：选择日期后立即看到结果

### 2. 数据准确性
- **精确计算**：考虑月份和日期差异
- **生日处理**：正确处理是否已过生日
- **边界保护**：防止负数年龄

### 3. 界面友好
- **状态明确**：清楚显示字段是否可编辑
- **提示完善**：用户了解功能用途
- **视觉反馈**：不同状态有不同样式

---

**实现完成时间：** 2025年1月  
**功能状态：** ✅ 已完成  
**测试状态：** 🔄 待测试
