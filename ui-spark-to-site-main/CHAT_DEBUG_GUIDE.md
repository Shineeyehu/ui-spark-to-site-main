# 聊天功能调试指南

## 🔍 问题诊断

如果遇到"初始化聊天服务失败"错误，请按以下步骤进行调试：

### 1. 检查浏览器控制台

打开浏览器开发者工具（F12），查看 Console 标签页中的错误信息：

```javascript
// 应该看到这些日志：
检查扣子SDK: [object Object]
扣子SDK加载成功
开始初始化扣子客户端...
SDK状态: [object Object]
容器状态: <div>...</div>
配置参数: {botId: "7547965462022193162", token: "pat_...", ...}
扣子客户端配置: {...}
扣子客户端创建成功
扣子客户端准备就绪
```

### 2. 检查网络连接

确保能够访问扣子SDK的CDN：
- 访问：https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.1.0-beta.0/libs/cn/index.js
- 如果无法访问，可能是网络问题或防火墙阻止

### 3. 检查环境变量

确认 `.env.local` 文件存在且配置正确：

```bash
# 检查文件是否存在
Get-Content .env.local

# 应该看到：
VITE_COZE_BOT_ID=7547965462022193162
VITE_COZE_TOKEN=pat_zjpOuq7ytYhH8zTqkg7M3ygNpOLPvpGrg6MMZHXtg4ZHyb9CpCZwTg18CcVoIxMv
VITE_COZE_USER_ID=user_123
VITE_COZE_NICKNAME=用户
```

### 4. 重启开发服务器

环境变量更改后需要重启：

```bash
# 停止当前服务器 (Ctrl+C)
# 然后重新启动
npm run dev
```

## 🛠️ 常见问题解决

### 问题1：扣子SDK未加载
**症状**：控制台显示"扣子SDK未加载"
**解决方案**：
1. 检查网络连接
2. 尝试刷新页面
3. 检查防火墙设置

### 问题2：配置参数错误
**症状**：控制台显示"初始化聊天服务失败"
**解决方案**：
1. 检查 Bot ID 是否正确
2. 检查 Token 是否有效
3. 确认 Token 权限是否足够

### 问题3：容器未准备好
**症状**：控制台显示"聊天容器未准备好"
**解决方案**：
1. 确保页面完全加载
2. 检查 DOM 元素是否正确渲染

## 🧪 测试步骤

### 1. 基础功能测试
1. 访问 `http://localhost:8080/coze-test`
2. 查看配置状态是否显示"配置完整"
3. 点击"开启 AI 智能对话"按钮
4. 观察控制台日志

### 2. 深度咨询页面测试
1. 访问 `http://localhost:8080/deeptalk`
2. 点击"切换到 AI 模式"
3. 观察是否正常显示聊天界面

### 3. 生日页面测试
1. 访问 `http://localhost:8080/birthday`
2. 勾选"使用 AI 智能体深度分析"
3. 填写表单并提交
4. 观察聊天窗口是否正常打开

## 📋 调试清单

- [ ] 浏览器控制台无错误
- [ ] 扣子SDK成功加载
- [ ] 环境变量配置正确
- [ ] 网络连接正常
- [ ] 开发服务器已重启
- [ ] 配置状态显示"配置完整"

## 🚨 如果问题仍然存在

1. **清除浏览器缓存**：Ctrl+Shift+R 强制刷新
2. **检查扣子平台状态**：访问 https://www.coze.cn 确认服务正常
3. **验证Token权限**：在扣子平台检查Token是否有效
4. **尝试不同的浏览器**：排除浏览器兼容性问题

## 📞 获取帮助

如果以上步骤都无法解决问题，请提供：
1. 浏览器控制台的完整错误日志
2. 网络请求的详细信息
3. 使用的浏览器版本
4. 操作系统信息

这样我可以提供更精确的解决方案。

